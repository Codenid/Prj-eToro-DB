<div align="center">

### UNIVERSIDAD DE INGENIER√çA Y TECNOLOG√çA  
**Maestr√≠a en Ciencia de Datos e Inteligencia Artificial**

---

# Base de Datos ‚Äì An√°lisis de Negocio y Modelado Relacional  
**Empresa Analizada: _eToro_**

---

</div>

**Integrantes**  
- Diego S√°nchez Salazar  
- Estuardo Oliver Campos  
- Nicole Arenas Lazo  
- Gianmarco Alessandro Mej√≠a Mel√©ndez  
- Piero Palacios Bernuy  
- Edgard Inga Froylan  
- Winton Flores Quispe

**Docente:** Luis Chicoma  
**Fecha:** 14 de octubre de 2025  

---

## √çndice

- [Resumen ejecutivo](#-resumen-ejecutivo)
- [1. An√°lisis de la empresa eToro](#1-an√°lisis-de-la-empresa-etoro)
  - [1.1 Giro de negocio](#11-giro-de-negocio)
  - [1.2 Clientes](#12-clientes)
  - [1.3 Productos y servicios](#13-productos-y-servicios)
  - [1.4 Canales](#14-canales)
  - [1.5 Business Model Canvas](#15-business-model-canvas)
- [2. Modelo Entidad‚ÄìRelaci√≥n (ER)](#2-modelo-entidadrelaci√≥n-er)
- [3. Implementaci√≥n en SQL](#3-implementaci√≥n-en-sql)
  - [3.1 Definiciones (DDL)](#31-definiciones-ddl)
  - [3.2 Carga inicial (DML)](#32-carga-inicial-dml)
- [4. Consultas de negocio orientadas a IA](#4-consultas-de-negocio-orientadas-a-ia)
- [5. Propuesta de features para IA](#5-propuesta-de-features-para-ia)
- [6. Conclusiones](#6-conclusiones)
- [Anexos](#anexos)
  - [Anexo A. Esquema DDL (CREATE TABLE)](#anexo-a-esquema-ddl-create-table)
  - [Anexo B. Carga DML (INSERT INTO)](#anexo-b-carga-dml-insert-into)
  - [Anexo C. Visi√≥n de esquema y diccionario de datos](#anexo-c-visi√≥n-de-esquema-y-diccionario-de-datos)

---

# üìò RESUMEN EJECUTIVO

Este informe acad√©mico analiza el modelo de negocio y la estructura de base de datos de **eToro**, una fintech global enfocada en el *trading social* y la inversi√≥n en l√≠nea. El documento abarca an√°lisis, dise√±o e implementaci√≥n del modelo relacional del canal principal, e integra consultas orientadas a la **generaci√≥n de features** para modelos de IA.

[‚Üë Volver al √≠ndice](#√≠ndice)

---

# 1. AN√ÅLISIS DE LA EMPRESA ETORO

## 1.1 Giro de Negocio
eToro es una **plataforma de corretaje y fintech** de inversi√≥n multi-activo con un componente de red social, que permite **copiar estrategias** de inversores.

## 1.2 Clientes
Foco en **inversionistas minoristas** que operan online (web/m√≥vil) y aprenden de la comunidad. Presencia en **>100 pa√≠ses**.

## 1.3 Productos y Servicios
- Activos: acciones, criptomonedas, ETFs, divisas, √≠ndices, materias primas.  
- Social trading: *CopyTrader*, *Smart Portfolios*.  
- Servicios: dep√≥sitos/retiros, FX y educacionales.

## 1.4 Canales Principales
- Plataforma web y aplicaci√≥n m√≥vil (canal principal).  
- Marketing digital, redes sociales, centro de ayuda.

## 1.5 Business Model Canvas
| Elemento | Descripci√≥n |
|---|---|
| Segmentos de Clientes | Inversores minoristas con inter√©s en trading social. |
| Propuesta de Valor | Inversi√≥n multi-activo + red social de trading. |
| Canales | App, web, marketing digital, comunidad. |
| Relaciones con Clientes | Comunidad social, soporte, recompensas. |
| Fuentes de Ingresos | Spreads, comisiones, tarifas, conversiones. |
| Recursos Clave | Tecnolog√≠a, licencias, comunidad, alianzas. |
| Actividades Clave | Desarrollo, marketing, soporte, cumplimiento. |
| Socios Clave | Bancos, redes de pago, proveedores de liquidez. |
| Estructura de Costos | Tecnolog√≠a, marketing, soporte, cumplimiento. |

[‚Üë Volver al √≠ndice](#√≠ndice)

---

# 2. MODELO ENTIDAD‚ÄìRELACI√ìN (ER)

El modelo refleja la estructura l√≥gica del canal digital principal. Incluye entidades de usuarios, cuentas, operaciones y actividades sociales.

```mermaid
erDiagram
  users ||--o{ accounts : "tiene"
  accounts ||--o{ orders : "genera"
  orders ||--o{ order_fills : "se ejecuta en"
  users ||--o{ kyc_profiles : "verifica"
  users ||--o{ devices : "usa"
  users ||--o{ social_posts : "publica"
  social_posts ||--o{ social_comments : "recibe"
  social_posts ||--o{ social_likes : "genera"
```

*(Extracto visual resumido del modelo completo).*  

### MER
![MER-eToro](./MER_eToro.png)

[‚Üë Volver al √≠ndice](#√≠ndice)

---

# 3. IMPLEMENTACI√ìN EN SQL

Implementaci√≥n en **PostgreSQL 13+**, con **UUID**, **ENUMs**, claves for√°neas e √≠ndices.

## 3.1 Definiciones (DDL)

> Ver **[Anexo A](#anexo-a-esquema-ddl-create-table)**.

## 3.2 Carga inicial (DML)

> Ver **[Anexo B](#anexo-b-carga-dml-insert-into)**.

[‚Üë Volver al √≠ndice](#√≠ndice)

---

# 4. CONSULTAS DE NEGOCIO ORIENTADAS A IA

* **Conversi√≥n temprana (7 d√≠as)**
  Mide la activaci√≥n inicial: porcentaje de usuarios cuyo **primer trade** ocurre dentro de los 7 d√≠as posteriores al registro; insumo directo para optimizar onboarding y nudges.

* **Intervalo promedio entre compras por grupo (mes de registro)**
  Compara la **frecuencia de compra** entre grupos de usuarios creados por **mes de registro**, calculando el **promedio de d√≠as entre compras** por grupo para ajustar cadencia de re-engagement.

* **AOV por categor√≠a**
  Calcula el **ticket promedio** por categor√≠a de producto/cartera (normalizado a moneda base) para priorizar categor√≠as rentables y orientar campa√±as y cross-sell.

* **Devoluciones‚Äìreclamos**
  Estima la **fricci√≥n operacional** como raz√≥n de (devoluciones + *chargebacks*) sobre transacciones, para detectar problemas por **m√©todo de pago/PSP/pa√≠s** y gatillar acciones antifraude/soporte.

* **Churn (90 d√≠as)**
  Identifica **inactividad** marcando usuarios sin actividad relevante por >90 d√≠as, habilitando **win-back** segmentado seg√∫n riesgo/valor (LTV) y canal de adquisici√≥n.


[‚Üë Volver al √≠ndice](#√≠ndice)

---

# 5. PROPUESTA DE FEATURES PARA IA

| Nombre                                      | Descripci√≥n                                                                                                       | Script SQL                                                                                   | Uso en IA                                      |
|---------------------------------------------|-------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------|------------------------------------------------|
| Engagement de 30 d√≠as: sesiones, d√≠as activos, eventos y apertura de notificaciones                | Construye se√±ales de comportamiento recientes para modelos de **retenci√≥n y churn**. Calcula, por usuario, la actividad en los √∫ltimos **30 d√≠as**: n√∫mero de **sesiones**, **d√≠as activos**, **eventos** de app, **pushes enviados/abiertos** y la **tasa de apertura**. El resultado sirve como *feature store* continuo y puede segmentarse en **bajo/medio/alto** engagement para operaci√≥n. | [30_day_engagement_feature.sql](./queries_of_the_bussiness/30_day_engagement_feature.sql)          | Onboarding, propensity to start                |
| Comportamiento y desempe√±o de trading a 90 d√≠as | Caracteriza el **estilo** y la **habilidad** del usuario en los √∫ltimos 90 d√≠as para recomendaciones de **copy-trading** y segmentaci√≥n: volumen y conteo de trades, **win rate**, **P&L realizado en USD**, **tama√±o promedio** y **diversificaci√≥n** por instrumentos y monedas. | [90_days_trading_behaviour.sql](./queries_of_the_bussiness/90_days_trading_behaviour.sql)                 | Retenci√≥n, segmentaci√≥n RFM                    |
| Riesgo de concentraci√≥n en posiciones abiertas (HHI)                 | Mide qu√© tan **concentrado** est√° el portafolio abierto de cada usuario usando el **√çndice de Herfindahl‚ÄìHirschman (HHI)**: suma de los **pesos al cuadrado** de cada instrumento sobre el valor total en USD. - **Cerca de 1** ‚Üí apuesta concentrada (uno o pocos instrumentos). - **Cerca de 0** ‚Üí portafolio diversificado. Incluye `margin_enabled` para capturar apetito de apalancamiento. | [concentration_risk.sql](./queries_of_the_bussiness/concentration_risk.sql)               | Propensi√≥n a volver, campa√±as in-app           |
| Influencia social y de copy-trading                   | Construye se√±ales para identificar **qui√©n conviene copiar** y **qui√©n influye** en la comunidad. Resume actividad creada y recibida (calidad de contenido/engagement) y prueba social operativa (seguidores y copiadores activos) para **rankear l√≠deres** y alimentar recomendaciones de **CopyTrader**.                           | [social_and_copy_trading.sql](./queries_of_the_bussiness/social_and_copy_trading.sql)               | Churn modeling, triggers de win-back           |
| Top 100 usuarios leales (score combinado de engagement + retenci√≥n)                  | Este an√°lisis identifica a los 100 usuarios m√°s leales de la plataforma, combinando su nivel de actividad reciente, intensidad de uso diario, respuesta a notificaciones y retenci√≥n a 90 d√≠as, para revelar qui√©nes sostienen el mayor compromiso real con¬†el¬†ecosistema.                   | [top_100_loyal_users_query.sql](./queries_of_the_bussiness/top_100_loyal_users_query.sql)         | Eficiencia de adquisici√≥n, ROAS                |


[‚Üë Volver al √≠ndice](#√≠ndice)

---

# 6. CONCLUSIONES

El modelo relacional es **coherente con la operaci√≥n fintech** y habilita integridad y anal√≠tica para **activaci√≥n, valor y retenci√≥n** en modelos predictivos.  

[‚Üë Volver al √≠ndice](#√≠ndice)

---

# Anexos

## Anexo A. Esquema DDL (CREATE TABLE)

> Base de datos de eToro.  

[DB eToro DDL](./creation_of_db/schema.sql)

> DDL para Features

[Features DDL](./creation_of_features/features_schemas.sql)
[Data Features DDL](./creation_of_features/fill_of_features.sql)

## Anexo B. Carga DML (INSERT INTO)

> Data de prueba.  

[Data eToro DML](./creation_of_db/seed_data.sql)

---

## Anexo C. Visi√≥n de esquema y diccionario de datos

### Schema Overview (dominios)

**Identity, Access & Compliance**
`users`, `user_auth`, `kyc_profiles`, `risk_assessments`, `regulatory_consents`

**Devices, Telemetry & Notifications**
`devices`, `push_tokens`, `app_sessions`, `app_events`, `notifications`, `attribution_installs`

**Currencies, Accounts & Ledger**
`currencies`, `exchange_rates`, `accounts`, `account_balances`, `ledger_entries`, `payments`, `deposits`, `withdrawals`

**Markets, Orders & Positions**
`instruments`, `instrument_prices`, `orders`, `order_fills`, `positions`

**Portfolios & Social**
`portfolios`, `portfolio_positions`, `smart_portfolios`, `smart_portfolio_allocations`, `copy_trading_links`, `watchlists`, `watchlist_items`, `social_posts`, `social_comments`, `social_likes`, `follows`

**Feature Store (propuesto)**
`feat.user_features_core`, `feat.user_features_onboarding`, `feat.user_features_engagement_30d`, `feat.user_features_trading_90d`, `feat.user_features_concentration_open`, `feat.user_features_social`


---

### 1) Identity, Access & Compliance

#### `users` ‚Äî Perfil base

| Columna      | Tipo        | Nulo | Default           | PK | FK | Descripci√≥n                       |
| ------------ | ----------- | ---- | ----------------- | -- | -- | --------------------------------- |
| id           | uuid        |      | gen_random_uuid() | ‚úîÔ∏è |    | Identificador √∫nico del usuario.  |
| email        | varchar     |      |                   |    |    | Correo √∫nico para login/avisos.   |
| phone        | varchar     | ‚úîÔ∏è   |                   |    |    | Tel√©fono (opcional).              |
| display_name | varchar     | ‚úîÔ∏è   |                   |    |    | Alias p√∫blico en la red social.   |
| country_code | varchar(2)  | ‚úîÔ∏è   |                   |    |    | C√≥digo ISO del pa√≠s.              |
| created_at   | timestamptz |      | now()             |    |    | Fecha de alta.                    |
| status       | varchar(20) | ‚úîÔ∏è   |                   |    |    | Estado (active/suspended/closed). |

#### `user_auth` ‚Äî Proveedores de autenticaci√≥n

| Columna       | Tipo         | Nulo | Default           | PK | FK        | Descripci√≥n                       |
| ------------- | ------------ | ---- | ----------------- | -- | --------- | --------------------------------- |
| id            | uuid         |      | gen_random_uuid() | ‚úîÔ∏è |           | ID del v√≠nculo de autenticaci√≥n.  |
| user_id       | uuid         |      |                   |    | users(id) | Usuario asociado.                 |
| provider      | varchar(50)  | ‚úîÔ∏è   |                   |    |           | password/google/apple‚Ä¶            |
| provider_uid  | varchar(200) | ‚úîÔ∏è   |                   |    |           | Identificador en el proveedor.    |
| last_login_at | timestamptz  | ‚úîÔ∏è   |                   |    |           | √öltimo inicio por este proveedor. |
| mfa_enabled   | boolean      | ‚úîÔ∏è   |                   |    |           | MFA habilitado.                   |

#### `kyc_profiles` ‚Äî Verificaci√≥n de identidad (KYC)

| Columna          | Tipo        | Nulo | Default           | PK | FK        | Descripci√≥n                  |
| ---------------- | ----------- | ---- | ----------------- | -- | --------- | ---------------------------- |
| id               | uuid        |      | gen_random_uuid() | ‚úîÔ∏è |           | ID KYC.                      |
| user_id          | uuid        |      |                   |    | users(id) | Usuario verificado.          |
| status           | kyc_status  |      | 'pending'         |    |           | Estado (pending/approved/‚Ä¶). |
| document_type    | varchar(30) | ‚úîÔ∏è   |                   |    |           | Tipo de documento.           |
| document_country | varchar(2)  | ‚úîÔ∏è   |                   |    |           | Pa√≠s emisor.                 |
| submitted_at     | timestamptz | ‚úîÔ∏è   |                   |    |           | Env√≠o KYC.                   |
| reviewed_at      | timestamptz | ‚úîÔ∏è   |                   |    |           | Revisi√≥n KYC.                |

#### `risk_assessments` ‚Äî Perfil de riesgo del inversor

| Columna               | Tipo        | Nulo | Default           | PK | FK        | Descripci√≥n              |
| --------------------- | ----------- | ---- | ----------------- | -- | --------- | ------------------------ |
| id                    | uuid        |      | gen_random_uuid() | ‚úîÔ∏è |           | ID evaluaci√≥n.           |
| user_id               | uuid        |      |                   |    | users(id) | Usuario evaluado.        |
| level                 | risk_level  |      |                   |    |           | Nivel (low/‚Ä¶/very_high). |
| questionnaire_version | varchar(20) | ‚úîÔ∏è   |                   |    |           | Versi√≥n de cuestionario. |
| score                 | int         | ‚úîÔ∏è   |                   |    |           | Puntuaci√≥n cuantitativa. |
| assessed_at           | timestamptz |      |                   |    |           | Fecha de evaluaci√≥n.     |

#### `regulatory_consents` ‚Äî Consentimientos regulatorios

| Columna      | Tipo        | Nulo | Default           | PK | FK        | Descripci√≥n                        |
| ------------ | ----------- | ---- | ----------------- | -- | --------- | ---------------------------------- |
| id           | uuid        |      | gen_random_uuid() | ‚úîÔ∏è |           | ID consentimiento.                 |
| user_id      | uuid        |      |                   |    | users(id) | Usuario que acepta.                |
| consent_code | varchar(50) | ‚úîÔ∏è   |                   |    |           | C√≥digo (tos, privacy, marketing‚Ä¶). |
| accepted     | boolean     |      | true              |    |           | Indicador de aceptaci√≥n.           |
| accepted_at  | timestamptz |      | now()             |    |           | Fecha de aceptaci√≥n.               |
| locale       | varchar(10) | ‚úîÔ∏è   |                   |    |           | Idioma/regi√≥n.                     |

---

### 2) Devices, Telemetry & Notifications

#### `devices` ‚Äî Dispositivos

| Columna      | Tipo            | Nulo | Default           | PK | FK        | Descripci√≥n           |
| ------------ | --------------- | ---- | ----------------- | -- | --------- | --------------------- |
| id           | uuid            |      | gen_random_uuid() | ‚úîÔ∏è |           | ID del dispositivo.   |
| user_id      | uuid            |      |                   |    | users(id) | Propietario.          |
| platform     | device_platform |      |                   |    |           | iOS/Android.          |
| os_version   | varchar(40)     | ‚úîÔ∏è   |                   |    |           | Versi√≥n del SO.       |
| app_version  | varchar(20)     | ‚úîÔ∏è   |                   |    |           | Versi√≥n de la app.    |
| device_model | varchar(80)     | ‚úîÔ∏è   |                   |    |           | Modelo.               |
| installed_at | timestamptz     | ‚úîÔ∏è   |                   |    |           | Fecha de instalaci√≥n. |
| last_seen_at | timestamptz     | ‚úîÔ∏è   |                   |    |           | √öltima actividad.     |

#### `push_tokens` ‚Äî Tokens de notificaci√≥n

| Columna        | Tipo         | Nulo | Default           | PK | FK          | Descripci√≥n           |
| -------------- | ------------ | ---- | ----------------- | -- | ----------- | --------------------- |
| id             | uuid         |      | gen_random_uuid() | ‚úîÔ∏è |             | ID token.             |
| device_id      | uuid         |      |                   |    | devices(id) | Dispositivo asociado. |
| token          | varchar(300) |      |                   |    |             | Token push.           |
| provider       | varchar(20)  | ‚úîÔ∏è   |                   |    |             | apns/fcm.             |
| valid          | boolean      | ‚úîÔ∏è   | true              |    |             | Vigente.              |
| created_at     | timestamptz  | ‚úîÔ∏è   | now()             |    |             | Alta.                 |
| invalidated_at | timestamptz  | ‚úîÔ∏è   |                   |    |             | Invalidez.            |

#### `app_sessions` ‚Äî Sesiones de aplicaci√≥n

| Columna       | Tipo         | Nulo | Default           | PK | FK          | Descripci√≥n      |
| ------------- | ------------ | ---- | ----------------- | -- | ----------- | ---------------- |
| id            | uuid         |      | gen_random_uuid() | ‚úîÔ∏è |             | ID sesi√≥n.       |
| user_id       | uuid         |      |                   |    | users(id)   | Usuario.         |
| device_id     | uuid         |      |                   |    | devices(id) | Dispositivo.     |
| started_at    | timestamptz  |      | now()             |    |             | Inicio.          |
| ended_at      | timestamptz  | ‚úîÔ∏è   |                   |    |             | Fin.             |
| city          | varchar(100) | ‚úîÔ∏è   |                   |    |             | Ciudad estimada. |
| ip            | inet         | ‚úîÔ∏è   |                   |    |             | IP.              |
| is_foreground | boolean      | ‚úîÔ∏è   |                   |    |             | En primer plano. |

#### `app_events` ‚Äî Eventos de interacci√≥n/SDK

| Columna      | Tipo         | Nulo | Default           | PK | FK               | Descripci√≥n              |
| ------------ | ------------ | ---- | ----------------- | -- | ---------------- | ------------------------ |
| id           | uuid         |      | gen_random_uuid() | ‚úîÔ∏è |                  | ID evento.               |
| session_id   | uuid         |      |                   |    | app_sessions(id) | Sesi√≥n origen.           |
| user_id      | uuid         | ‚úîÔ∏è   |                   |    | users(id)        | Usuario (si aplica).     |
| device_id    | uuid         | ‚úîÔ∏è   |                   |    | devices(id)      | Dispositivo (si aplica). |
| event_name   | varchar(100) |      |                   |    |                  | Nombre del evento.       |
| event_source | event_source |      | 'app_ui'          |    |                  | Origen (ui/background‚Ä¶). |
| event_ts     | timestamptz  |      | now()             |    |                  | Marca temporal.          |
| screen       | varchar(100) | ‚úîÔ∏è   |                   |    |                  | Pantalla.                |
| metadata     | jsonb        | ‚úîÔ∏è   |                   |    |                  | Pares clave-valor.       |

#### `notifications` ‚Äî Mensajer√≠a in-app/push

| Columna      | Tipo                 | Nulo | Default           | PK | FK        | Descripci√≥n       |
| ------------ | -------------------- | ---- | ----------------- | -- | --------- | ----------------- |
| id           | uuid                 |      | gen_random_uuid() | ‚úîÔ∏è |           | ID notificaci√≥n.  |
| user_id      | uuid                 |      |                   |    | users(id) | Destinatario.     |
| channel      | notification_channel |      |                   |    |           | in_app/push.      |
| title        | varchar(140)         | ‚úîÔ∏è   |                   |    |           | T√≠tulo.           |
| body         | text                 | ‚úîÔ∏è   |                   |    |           | Contenido.        |
| created_at   | timestamptz          |      | now()             |    |           | Creaci√≥n.         |
| delivered_at | timestamptz          | ‚úîÔ∏è   |                   |    |           | Entrega.          |
| opened_at    | timestamptz          | ‚úîÔ∏è   |                   |    |           | Apertura.         |
| deeplink     | varchar(300)         | ‚úîÔ∏è   |                   |    |           | Destino profundo. |

#### `attribution_installs` ‚Äî Atribuci√≥n de campa√±as

| Columna    | Tipo         | Nulo | Default           | PK | FK          | Descripci√≥n          |
| ---------- | ------------ | ---- | ----------------- | -- | ----------- | -------------------- |
| id         | uuid         |      | gen_random_uuid() | ‚úîÔ∏è |             | ID atribuci√≥n.       |
| device_id  | uuid         |      |                   |    | devices(id) | Dispositivo.         |
| network    | varchar(60)  | ‚úîÔ∏è   |                   |    |             | Red publicitaria.    |
| campaign   | varchar(120) | ‚úîÔ∏è   |                   |    |             | Campa√±a.             |
| adgroup    | varchar(120) | ‚úîÔ∏è   |                   |    |             | Grupo de anuncios.   |
| click_ts   | timestamptz  | ‚úîÔ∏è   |                   |    |             | Hora de clic.        |
| install_ts | timestamptz  | ‚úîÔ∏è   |                   |    |             | Hora de instalaci√≥n. |

---

### 3) Currencies, Accounts & Ledger

#### `currencies` ‚Äî Monedas ISO

| Columna | Tipo        | Nulo | Default | PK | FK | Descripci√≥n |
| ------- | ----------- | ---- | ------- | -- | -- | ----------- |
| code    | varchar(3)  |      |         | ‚úîÔ∏è |    | C√≥digo ISO. |
| name    | varchar(30) | ‚úîÔ∏è   |         |    |    | Nombre.     |
| symbol  | varchar(5)  | ‚úîÔ∏è   |         |    |    | S√≠mbolo.    |

#### `exchange_rates` ‚Äî Tipos de cambio

| Columna        | Tipo          | Nulo | Default           | PK | FK               | Descripci√≥n      |
| -------------- | ------------- | ---- | ----------------- | -- | ---------------- | ---------------- |
| id             | uuid          |      | gen_random_uuid() | ‚úîÔ∏è |                  | ID.              |
| base_currency  | varchar(3)    |      |                   |    | currencies(code) | Moneda base.     |
| quote_currency | varchar(3)    |      |                   |    | currencies(code) | Moneda cotizada. |
| rate           | numeric(18,8) |      |                   |    |                  | Tipo de cambio.  |
| as_of          | timestamptz   |      |                   |    |                  | Vigencia.        |
| source         | varchar(40)   | ‚úîÔ∏è   |                   |    |                  | Proveedor.       |

#### `accounts` ‚Äî Cuentas de trading

| Columna           | Tipo        | Nulo | Default           | PK | FK               | Descripci√≥n     |
| ----------------- | ----------- | ---- | ----------------- | -- | ---------------- | --------------- |
| id                | uuid        |      | gen_random_uuid() | ‚úîÔ∏è |                  | ID cuenta.      |
| user_id           | uuid        |      |                   |    | users(id)        | Propietario.    |
| base_currency     | varchar(3)  |      |                   |    | currencies(code) | Moneda base.    |
| opened_at         | timestamptz |      | now()             |    |                  | Apertura.       |
| is_margin_enabled | boolean     | ‚úîÔ∏è   | false             |    |                  | Permite margen. |
| status            | varchar(20) | ‚úîÔ∏è   |                   |    |                  | Estado.         |

#### `account_balances` ‚Äî Saldos por moneda

| Columna        | Tipo          | Nulo | Default           | PK | FK               | Descripci√≥n           |
| -------------- | ------------- | ---- | ----------------- | -- | ---------------- | --------------------- |
| id             | uuid          |      | gen_random_uuid() | ‚úîÔ∏è |                  | ID saldo.             |
| account_id     | uuid          |      |                   |    | accounts(id)     | Cuenta.               |
| currency       | varchar(3)    |      |                   |    | currencies(code) | Moneda.               |
| cash_available | numeric(20,2) |      | 0                 |    |                  | Saldo disponible.     |
| cash_locked    | numeric(20,2) |      | 0                 |    |                  | Saldo bloqueado.      |
| updated_at     | timestamptz   |      | now()             |    |                  | √öltima actualizaci√≥n. |

#### `ledger_entries` ‚Äî Libro mayor (cash)

| Columna      | Tipo          | Nulo | Default           | PK | FK               | Descripci√≥n                       |
| ------------ | ------------- | ---- | ----------------- | -- | ---------------- | --------------------------------- |
| id           | uuid          |      | gen_random_uuid() | ‚úîÔ∏è |                  | ID asiento.                       |
| account_id   | uuid          |      |                   |    | accounts(id)     | Cuenta afectada.                  |
| currency     | varchar(3)    |      |                   |    | currencies(code) | Moneda.                           |
| amount       | numeric(20,2) |      |                   |    |                  | Importe (+cr/‚àídb).                |
| type         | varchar(40)   | ‚úîÔ∏è   |                   |    |                  | Motivo (trade_fill/deposit/fee‚Ä¶). |
| reference_id | uuid          | ‚úîÔ∏è   |                   |    |                  | Referencia operacional.           |
| created_at   | timestamptz   |      | now()             |    |                  | Fecha del asiento.                |

#### `payments` ‚Äî Pagos (funding)

| Columna        | Tipo           | Nulo | Default           | PK | FK               | Descripci√≥n                        |
| -------------- | -------------- | ---- | ----------------- | -- | ---------------- | ---------------------------------- |
| id             | uuid           |      | gen_random_uuid() | ‚úîÔ∏è |                  | ID pago.                           |
| user_id        | uuid           |      |                   |    | users(id)        | Pagador.                           |
| method         | payment_method |      |                   |    |                  | M√©todo (card/bank/ewallet/crypto). |
| status         | payment_status |      |                   |    |                  | Estado.                            |
| currency       | varchar(3)     |      |                   |    | currencies(code) | Moneda.                            |
| amount         | numeric(20,2)  |      |                   |    |                  | Importe.                           |
| provider       | varchar(40)    | ‚úîÔ∏è   |                   |    |                  | PSP o red.                         |
| created_at     | timestamptz    |      | now()             |    |                  | Creaci√≥n.                          |
| settled_at     | timestamptz    | ‚úîÔ∏è   |                   |    |                  | Liquidaci√≥n.                       |
| failure_reason | varchar(200)   | ‚úîÔ∏è   |                   |    |                  | Motivo de fallo.                   |

#### `deposits` ‚Äî Dep√≥sitos

| Columna    | Tipo          | Nulo | Default           | PK | FK           | Descripci√≥n     |
| ---------- | ------------- | ---- | ----------------- | -- | ------------ | --------------- |
| id         | uuid          |      | gen_random_uuid() | ‚úîÔ∏è |              | ID dep√≥sito.    |
| account_id | uuid          |      |                   |    | accounts(id) | Cuenta destino. |
| payment_id | uuid          |      |                   |    | payments(id) | Pago de origen. |
| amount     | numeric(20,2) |      |                   |    |              | Importe.        |
| created_at | timestamptz   |      | now()             |    |              | Fecha.          |

#### `withdrawals` ‚Äî Retiros

| Columna    | Tipo          | Nulo | Default           | PK | FK           | Descripci√≥n      |
| ---------- | ------------- | ---- | ----------------- | -- | ------------ | ---------------- |
| id         | uuid          |      | gen_random_uuid() | ‚úîÔ∏è |              | ID retiro.       |
| account_id | uuid          |      |                   |    | accounts(id) | Cuenta origen.   |
| payment_id | uuid          |      |                   |    | payments(id) | Medio de retiro. |
| amount     | numeric(20,2) |      |                   |    |              | Importe.         |
| fee        | numeric(20,2) | ‚úîÔ∏è   | 0                 |    |              | Comisi√≥n.        |
| created_at | timestamptz   |      | now()             |    |              | Fecha.           |

---

### 4) Markets, Orders & Positions

#### `instruments` ‚Äî Instrumentos listados

| Columna        | Tipo            | Nulo | Default           | PK | FK               | Descripci√≥n              |
| -------------- | --------------- | ---- | ----------------- | -- | ---------------- | ------------------------ |
| id             | uuid            |      | gen_random_uuid() | ‚úîÔ∏è |                  | ID instrumento.          |
| symbol         | varchar(30)     |      |                   |    |                  | Ticker (AAPL, BTC‚Ä¶).     |
| name           | varchar(120)    | ‚úîÔ∏è   |                   |    |                  | Nombre.                  |
| type           | instrument_type |      |                   |    |                  | Tipo (equity/crypto/‚Ä¶).  |
| quote_currency | varchar(3)      | ‚úîÔ∏è   |                   |    | currencies(code) | Moneda de cotizaci√≥n.    |
| is_tradable    | boolean         | ‚úîÔ∏è   | true              |    |                  | Habilitado para trading. |

#### `instrument_prices` ‚Äî Cotizaciones

| Columna       | Tipo          | Nulo | Default           | PK | FK              | Descripci√≥n               |
| ------------- | ------------- | ---- | ----------------- | -- | --------------- | ------------------------- |
| id            | uuid          |      | gen_random_uuid() | ‚úîÔ∏è |                 | ID precio.                |
| instrument_id | uuid          |      |                   |    | instruments(id) | Instrumento.              |
| price         | numeric(20,8) |      |                   |    |                 | Precio.                   |
| as_of         | timestamptz   |      |                   |    |                 | Momento de la cotizaci√≥n. |
| source        | varchar(40)   | ‚úîÔ∏è   |                   |    |                 | Proveedor.                |

#### `orders` ‚Äî √ìrdenes (intenci√≥n)

| Columna       | Tipo           | Nulo | Default           | PK | FK              | Descripci√≥n              |
| ------------- | -------------- | ---- | ----------------- | -- | --------------- | ------------------------ |
| id            | uuid           |      | gen_random_uuid() | ‚úîÔ∏è |                 | ID orden.                |
| account_id    | uuid           |      |                   |    | accounts(id)    | Cuenta emisora.          |
| instrument_id | uuid           |      |                   |    | instruments(id) | Instrumento.             |
| side          | order_side     |      |                   |    |                 | Lado (buy/sell).         |
| type          | order_type     |      |                   |    |                 | Tipo (market/limit/‚Ä¶).   |
| tif           | time_in_force  |      | 'gtc'             |    |                 | Vigencia (GTC/DAY/‚Ä¶).    |
| quantity      | numeric(28,10) |      |                   |    |                 | Cantidad.                |
| limit_price   | numeric(20,8)  | ‚úîÔ∏è   |                   |    |                 | Precio l√≠mite.           |
| stop_price    | numeric(20,8)  | ‚úîÔ∏è   |                   |    |                 | Precio stop.             |
| status        | order_status   |      | 'pending'         |    |                 | Estado.                  |
| placed_at     | timestamptz    |      | now()             |    |                 | Colocaci√≥n.              |
| placed_via    | varchar(20)    | ‚úîÔ∏è   |                   |    |                 | Origen (mobile/web/api). |

#### `order_fills` ‚Äî Ejecuciones (fills)

| Columna  | Tipo           | Nulo | Default           | PK | FK         | Descripci√≥n         |
| -------- | -------------- | ---- | ----------------- | -- | ---------- | ------------------- |
| id       | uuid           |      | gen_random_uuid() | ‚úîÔ∏è |            | ID fill.            |
| order_id | uuid           |      |                   |    | orders(id) | Orden asociada.     |
| fill_ts  | timestamptz    |      | now()             |    |            | Hora de ejecuci√≥n.  |
| quantity | numeric(28,10) |      |                   |    |            | Cantidad ejecutada. |
| price    | numeric(20,8)  |      |                   |    |            | Precio ejecutado.   |
| fee      | numeric(20,8)  | ‚úîÔ∏è   | 0                 |    |            | Comisi√≥n.           |

#### `positions` ‚Äî Inventario de posiciones

| Columna       | Tipo            | Nulo | Default           | PK | FK              | Descripci√≥n           |
| ------------- | --------------- | ---- | ----------------- | -- | --------------- | --------------------- |
| id            | uuid            |      | gen_random_uuid() | ‚úîÔ∏è |                 | ID posici√≥n.          |
| account_id    | uuid            |      |                   |    | accounts(id)    | Due√±o de la posici√≥n. |
| instrument_id | uuid            |      |                   |    | instruments(id) | Instrumento.          |
| status        | position_status |      | 'open'            |    |                 | Estado (open/closed). |
| quantity      | numeric(28,10)  |      |                   |    |                 | Cantidad actual.      |
| avg_price     | numeric(20,8)   |      |                   |    |                 | Precio promedio.      |
| opened_at     | timestamptz     |      | now()             |    |                 | Apertura.             |
| closed_at     | timestamptz     | ‚úîÔ∏è   |                   |    |                 | Cierre (si aplica).   |

---

### 5) Portfolios & Social

#### `portfolios` ‚Äî Carteras de usuario/smart

| Columna    | Tipo        | Nulo | Default           | PK | FK        | Descripci√≥n      |
| ---------- | ----------- | ---- | ----------------- | -- | --------- | ---------------- |
| id         | uuid        |      | gen_random_uuid() | ‚úîÔ∏è |           | ID portafolio.   |
| user_id    | uuid        |      |                   |    | users(id) | Due√±o (si user). |
| name       | varchar(80) | ‚úîÔ∏è   |                   |    |           | Nombre.          |
| created_at | timestamptz |      | now()             |    |           | Creaci√≥n.        |
| type       | varchar(20) | ‚úîÔ∏è   |                   |    |           | user/smart.      |

#### `portfolio_positions` ‚Äî Componentes del portafolio

| Columna      | Tipo         | Nulo | Default           | PK | FK             | Descripci√≥n        |
| ------------ | ------------ | ---- | ----------------- | -- | -------------- | ------------------ |
| id           | uuid         |      | gen_random_uuid() | ‚úîÔ∏è |                | ID componente.     |
| portfolio_id | uuid         |      |                   |    | portfolios(id) | Portafolio.        |
| position_id  | uuid         |      |                   |    | positions(id)  | Posici√≥n incluida. |
| weight       | numeric(9,6) | ‚úîÔ∏è   |                   |    |                | Peso relativo.     |

#### `smart_portfolios` ‚Äî Productos rule-based

| Columna       | Tipo         | Nulo | Default           | PK | FK               | Descripci√≥n            |
| ------------- | ------------ | ---- | ----------------- | -- | ---------------- | ---------------------- |
| id            | uuid         |      | gen_random_uuid() | ‚úîÔ∏è |                  | ID smart.              |
| name          | varchar(120) |      |                   |    |                  | Nombre.                |
| description   | text         | ‚úîÔ∏è   |                   |    |                  | Descripci√≥n.           |
| base_currency | varchar(3)   |      |                   |    | currencies(code) | Moneda base.           |
| rebal_freq    | varchar(20)  | ‚úîÔ∏è   |                   |    |                  | Frecuencia rebalanceo. |
| created_at    | timestamptz  |      | now()             |    |                  | Alta.                  |

#### `smart_portfolio_allocations` ‚Äî Asignaciones objetivo

| Columna            | Tipo         | Nulo | Default           | PK | FK                   | Descripci√≥n    |
| ------------------ | ------------ | ---- | ----------------- | -- | -------------------- | -------------- |
| id                 | uuid         |      | gen_random_uuid() | ‚úîÔ∏è |                      | ID asignaci√≥n. |
| smart_portfolio_id | uuid         |      |                   |    | smart_portfolios(id) | Producto.      |
| instrument_id      | uuid         |      |                   |    | instruments(id)      | Instrumento.   |
| target_weight      | numeric(9,6) |      |                   |    |                      | Peso objetivo. |

#### `copy_trading_links` ‚Äî Relaciones follower/leader

| Columna          | Tipo         | Nulo | Default           | PK | FK           | Descripci√≥n         |
| ---------------- | ------------ | ---- | ----------------- | -- | ------------ | ------------------- |
| id               | uuid         |      | gen_random_uuid() | ‚úîÔ∏è |              | ID v√≠nculo.         |
| follower_user_id | uuid         |      |                   |    | users(id)    | Seguidor.           |
| leader_user_id   | uuid         |      |                   |    | users(id)    | L√≠der copiado.      |
| account_id       | uuid         |      |                   |    | accounts(id) | Cuenta asignada.    |
| allocation_pct   | numeric(6,3) |      |                   |    |              | % capital asignado. |
| started_at       | timestamptz  |      | now()             |    |              | Inicio.             |
| stopped_at       | timestamptz  | ‚úîÔ∏è   |                   |    |              | Fin.                |

#### `watchlists` ‚Äî Listas de seguimiento

| Columna    | Tipo        | Nulo | Default           | PK | FK        | Descripci√≥n  |
| ---------- | ----------- | ---- | ----------------- | -- | --------- | ------------ |
| id         | uuid        |      | gen_random_uuid() | ‚úîÔ∏è |           | ID lista.    |
| user_id    | uuid        |      |                   |    | users(id) | Propietario. |
| name       | varchar(60) | ‚úîÔ∏è   |                   |    |           | Nombre.      |
| created_at | timestamptz |      | now()             |    |           | Alta.        |

#### `watchlist_items` ‚Äî √çtems de lista

| Columna       | Tipo        | Nulo | Default           | PK | FK              | Descripci√≥n          |
| ------------- | ----------- | ---- | ----------------- | -- | --------------- | -------------------- |
| id            | uuid        |      | gen_random_uuid() | ‚úîÔ∏è |                 | ID √≠tem.             |
| watchlist_id  | uuid        |      |                   |    | watchlists(id)  | Lista.               |
| instrument_id | uuid        |      |                   |    | instruments(id) | Instrumento seguido. |
| added_at      | timestamptz |      | now()             |    |                 | Alta del √≠tem.       |

#### `social_posts` ‚Äî Publicaciones

| Columna       | Tipo        | Nulo | Default           | PK | FK              | Descripci√≥n              |
| ------------- | ----------- | ---- | ----------------- | -- | --------------- | ------------------------ |
| id            | uuid        |      | gen_random_uuid() | ‚úîÔ∏è |                 | ID post.                 |
| user_id       | uuid        |      |                   |    | users(id)       | Autor.                   |
| created_at    | timestamptz |      | now()             |    |                 | Publicaci√≥n.             |
| content       | text        | ‚úîÔ∏è   |                   |    |                 | Texto.                   |
| instrument_id | uuid        | ‚úîÔ∏è   |                   |    | instruments(id) | Instrumento (si aplica). |

#### `social_comments` ‚Äî Comentarios

| Columna    | Tipo        | Nulo | Default           | PK | FK               | Descripci√≥n    |
| ---------- | ----------- | ---- | ----------------- | -- | ---------------- | -------------- |
| id         | uuid        |      | gen_random_uuid() | ‚úîÔ∏è |                  | ID comentario. |
| post_id    | uuid        |      |                   |    | social_posts(id) | Post.          |
| user_id    | uuid        |      |                   |    | users(id)        | Autor.         |
| created_at | timestamptz |      | now()             |    |                  | Fecha.         |
| content    | text        | ‚úîÔ∏è   |                   |    |                  | Texto.         |

#### `social_likes` ‚Äî Likes

| Columna    | Tipo        | Nulo | Default           | PK | FK               | Descripci√≥n |
| ---------- | ----------- | ---- | ----------------- | -- | ---------------- | ----------- |
| id         | uuid        |      | gen_random_uuid() | ‚úîÔ∏è |                  | ID like.    |
| post_id    | uuid        |      |                   |    | social_posts(id) | Post.       |
| user_id    | uuid        |      |                   |    | users(id)        | Usuario.    |
| created_at | timestamptz |      | now()             |    |                  | Fecha.      |

#### `follows` ‚Äî Seguimientos entre usuarios

| Columna          | Tipo        | Nulo | Default           | PK | FK        | Descripci√≥n      |
| ---------------- | ----------- | ---- | ----------------- | -- | --------- | ---------------- |
| id               | uuid        |      | gen_random_uuid() | ‚úîÔ∏è |           | ID relaci√≥n.     |
| follower_user_id | uuid        |      |                   |    | users(id) | Quien sigue.     |
| followed_user_id | uuid        |      |                   |    | users(id) | A qui√©n sigue.   |
| created_at       | timestamptz |      | now()             |    |           | Alta del follow. |

---

### 6) Feature Store (propuesto)

> Esquema `feat.*` para *features* por usuario (PK compuesta `user_id, as_of_date`). A√±adir como capa anal√≠tica; no interfiere con el transaccional.

#### `feat.user_features_core`

| Columna       | Tipo        | Nulo | Descripci√≥n                     |
| ------------- | ----------- | ---- | ------------------------------- |
| user_id       | uuid        |      | Usuario.                        |
| as_of_date    | date        |      | Fecha de corte.                 |
| equity_usd    | numeric     | ‚úîÔ∏è   | Patrimonio estimado en USD.     |
| net_dep_usd   | numeric     | ‚úîÔ∏è   | Dep√≥sitos netos acumulados.     |
| money_won_usd | numeric     | ‚úîÔ∏è   | Ganancia bruta acumulada.       |
| status_label  | text        | ‚úîÔ∏è   | Etiqueta (nuevo/activo/riesgo). |
| created_at    | timestamptz |      | Creaci√≥n del registro.          |
| updated_at    | timestamptz |      | √öltima actualizaci√≥n.           |

#### `feat.user_features_onboarding`

| Columna                        | Tipo        | Nulo | Descripci√≥n                |
| ------------------------------ | ----------- | ---- | -------------------------- |
| user_id                        | uuid        |      | Usuario.                   |
| as_of_date                     | date        |      | Corte.                     |
| installed_at / kyc_* / first_* | timestamptz | ‚úîÔ∏è   | Hitos del embudo.          |
| hrs_*                          | numeric     | ‚úîÔ∏è   | Latencias entre hitos (h). |
| deposited / traded             | boolean     | ‚úîÔ∏è   | Indicadores de conversi√≥n. |
| created_at / updated_at        | timestamptz |      | Trazabilidad.              |

#### `feat.user_features_engagement_30d`

| Columna                        | Tipo         | Nulo | Descripci√≥n       |
| ------------------------------ | ------------ | ---- | ----------------- |
| user_id, as_of_date            | (uuid, date) |      | Clave del corte.  |
| sessions_30d / active_days_30d | int          | ‚úîÔ∏è   | Uso reciente.     |
| events_30d                     | int          | ‚úîÔ∏è   | Interacciones.    |
| pushes_sent/opened_30d         | int          | ‚úîÔ∏è   | Mensajer√≠a.       |
| push_open_rate_30d             | numeric      | ‚úîÔ∏è   | Tasa de apertura. |

#### `feat.user_features_trading_90d`

| Columna                                        | Tipo         | Nulo | Descripci√≥n        |
| ---------------------------------------------- | ------------ | ---- | ------------------ |
| user_id, as_of_date                            | (uuid, date) |      | Clave del corte.   |
| trade_count_90d                                | int          | ‚úîÔ∏è   | N¬∫ de operaciones. |
| win_rate_90d                                   | numeric      | ‚úîÔ∏è   | % ganadoras.       |
| avg_trade_notional_usd_90d                     | numeric      | ‚úîÔ∏è   | Ticket medio.      |
| realized_pnl_usd_90d                           | numeric      | ‚úîÔ∏è   | P&L realizado.     |
| instruments_traded_90d / currencies_traded_90d | int          | ‚úîÔ∏è   | Diversidad.        |

#### `feat.user_features_concentration_open`

| Columna                   | Tipo         | Nulo | Descripci√≥n               |
| ------------------------- | ------------ | ---- | ------------------------- |
| user_id, as_of_date       | (uuid, date) |      | Clave del corte.          |
| hhi_open_positions        | numeric      | ‚úîÔ∏è   | Concentraci√≥n (0‚Äì1).      |
| distinct_instruments_open | int          | ‚úîÔ∏è   | N¬∫ instrumentos abiertos. |
| margin_enabled            | boolean      | ‚úîÔ∏è   | Flag de margen.           |

#### `feat.user_features_social`

| Columna                         | Tipo         | Nulo | Descripci√≥n       |
| ------------------------------- | ------------ | ---- | ----------------- |
| user_id, as_of_date             | (uuid, date) |      | Clave del corte.  |
| posts/comments/likes_*          | int          | ‚úîÔ∏è   | Actividad social. |
| followers_count / copiers_count | int          | ‚úîÔ∏è   | Influencia.       |
| created_at / updated_at         | timestamptz  |      | Trazabilidad.     |

---

[‚Üë Volver al √≠ndice](#√≠ndice)

```